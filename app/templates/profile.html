{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="profile-container">
        <h1>Your Profile</h1>
        <div class="profile-info">
            <p>Username: {{ session.get('username') }}</p>
            <p>Email: {{ session.get('email') }}</p>
        </div>

        <div class="avatar-section">
            <h2>Choose Your Avatar</h2>
            <div class="avatar-grid">
                <div class="avatar-item" data-avatar="ArcticFox.jpg">
                    <img src="{{ url_for('static', filename='avatars/ArcticFox.jpg') }}" alt="Arctic Fox" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="BlossomArtist.jpg">
                    <img src="{{ url_for('static', filename='avatars/BlossomArtist.jpg') }}" alt="Blossom Artist" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="BrainyWizard.jpg">
                    <img src="{{ url_for('static', filename='avatars/BrainyWizard.jpg') }}" alt="Brainy Wizard" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Butterfly.jpg">
                    <img src="{{ url_for('static', filename='avatars/Butterfly.jpg') }}" alt="Butterfly" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Castle.jpg">
                    <img src="{{ url_for('static', filename='avatars/Castle.jpg') }}" alt="Castle" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="CreativeThinker.jpg">
                    <img src="{{ url_for('static', filename='avatars/CreativeThinker.jpg') }}" alt="Creative Thinker" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="CuteRobot.jpg">
                    <img src="{{ url_for('static', filename='avatars/CuteRobot.jpg') }}" alt="Cute Robot" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Dolphin.jpg">
                    <img src="{{ url_for('static', filename='avatars/Dolphin.jpg') }}" alt="Dolphin" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Dragon.jpg">
                    <img src="{{ url_for('static', filename='avatars/Dragon.jpg') }}" alt="Dragon" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="ElectricBunny.jpg">
                    <img src="{{ url_for('static', filename='avatars/ElectricBunny.jpg') }}" alt="Electric Bunny" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="HorrorRobot.jpg">
                    <img src="{{ url_for('static', filename='avatars/HorrorRobot.jpg') }}" alt="Horror Robot" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Lanterns.jpg">
                    <img src="{{ url_for('static', filename='avatars/Lanterns.jpg') }}" alt="Lanterns" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Leprechaun.jpg">
                    <img src="{{ url_for('static', filename='avatars/Leprechaun.jpg') }}" alt="Leprechaun" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="LordOfTheRings.jpg">
                    <img src="{{ url_for('static', filename='avatars/LordOfTheRings.jpg') }}" alt="Lord of the Rings" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="LovelyGarden.jpg">
                    <img src="{{ url_for('static', filename='avatars/LovelyGarden.jpg') }}" alt="Lovely Garden" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="MemorySage.jpg">
                    <img src="{{ url_for('static', filename='avatars/MemorySage.jpg') }}" alt="Memory Sage" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Mushroom.jpg">
                    <img src="{{ url_for('static', filename='avatars/Mushroom.jpg') }}" alt="Mushroom" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="PirateShip.jpg">
                    <img src="{{ url_for('static', filename='avatars/PirateShip.jpg') }}" alt="Pirate Ship" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="PuzzleLady.jpg">
                    <img src="{{ url_for('static', filename='avatars/PuzzleLady.jpg') }}" alt="Puzzle Lady" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Sculptor.jpg">
                    <img src="{{ url_for('static', filename='avatars/Sculptor.jpg') }}" alt="Sculptor" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="SmartRobot.jpg">
                    <img src="{{ url_for('static', filename='avatars/SmartRobot.jpg') }}" alt="Smart Robot" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="SpeedyThinkerM.jpg">
                    <img src="{{ url_for('static', filename='avatars/SpeedyThinkerM.jpg') }}" alt="Speedy Thinker" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="StrategyNight.jpg">
                    <img src="{{ url_for('static', filename='avatars/StrategyNight.jpg') }}" alt="Strategy Night" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="UFO.jpg">
                    <img src="{{ url_for('static', filename='avatars/UFO.jpg') }}" alt="UFO" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="Unicorn.jpg">
                    <img src="{{ url_for('static', filename='avatars/Unicorn.jpg') }}" alt="Unicorn" class="avatar-thumbnail">
                </div>
                <div class="avatar-item" data-avatar="WordNinja.jpg">
                    <img src="{{ url_for('static', filename='avatars/WordNinja.jpg') }}" alt="Word Ninja" class="avatar-thumbnail">
                </div>
            </div>
        </div>

        <div class="game-history">
            <h2>Your Game History</h2>
            <div class="history-list">
                {% for score in game_history %}
                <div class="score-card">
                    <div class="score-info">
                        <h3>{{ score.game_type }}</h3>
                        <p>{{ score.timestamp.strftime('%Y-%m-%d %H:%M:%S') if score.timestamp else score.date }}</p>
                    </div>
                    <div class="score-value">
                        Score: {{ score.score }}/{{ score.total if score.total else 100 }} ({{ "%.1f"|format((score.score/(score.total if score.total else 100))*100) }}%)
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Avatar Selection Modal hi-->
<div id="avatarModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <img id="modalAvatar" src="" alt="Selected Avatar" class="modal-avatar">
        <p>Do you want to save this image as your avatar?</p>
        <div class="modal-buttons">
            <button id="confirmAvatar" class="modal-button">Yes</button>
            <button id="cancelAvatar" class="modal-button">No</button>
        </div>
    </div>
</div>

<style>
.profile-container {
    max-width: 800px;
    margin: 8rem auto 4rem;
    padding: 2rem;
    background: var(--card-background);
    border-radius: 1.5rem;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
}

.profile-info {
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(244, 114, 182, 0.05));
    border-radius: 1rem;
}

.avatar-section {
    margin: 2rem 0;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(244, 114, 182, 0.05));
    border-radius: 1rem;
}

.avatar-section h2 {
    color: var(--primary-color);
    margin-bottom: 1.5rem;
    text-align: center;
}

.avatar-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
    gap: 0.75rem;
    padding: 0.5rem;
}

.avatar-item {
    aspect-ratio: 1;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease;
}

.avatar-item:hover {
    transform: scale(1.1);
}

.avatar-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
    cursor: pointer;
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.7);
    z-index: 1000;
}

.modal-content {
    position: relative;
    background-color: var(--card-background);
    margin: 15% auto;
    padding: 2rem;
    width: 80%;
    max-width: 500px;
    border-radius: 1rem;
    text-align: center;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
}

.modal-avatar {
    max-width: 100%;
    max-height: 300px;
    object-fit: contain;
    margin: 1rem 0;
    border-radius: 0.5rem;
}

.close-button {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--text-color);
}

.modal-buttons {
    display: flex;
    justify-content: center;
    gap: 1rem;
    margin-top: 1.5rem;
}

.modal-button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 0.5rem;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s ease;
}

#confirmAvatar {
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    color: white;
}

#cancelAvatar {
    background: var(--card-background);
    color: var(--text-color);
    border: 1px solid var(--text-color);
}

.modal-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.game-history {
    margin-top: 2rem;
}

.history-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.score-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(244, 114, 182, 0.05));
    border-radius: 0.75rem;
    transition: transform 0.2s ease;
}

.score-card:hover {
    transform: translateX(5px);
}

.score-info {
    display: flex;
    flex-direction: column;
}

.score-info h3 {
    font-weight: bold;
    color: var(--primary-color);
}

.score-info p {
    font-size: 0.9rem;
    color: var(--text-color);
    opacity: 0.8;
}

.score-value {
    font-weight: bold;
    color: var(--primary-color);
}

.success-message {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
    color: white;
    padding: 1rem 2rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    animation: slideIn 0.3s ease-out;
    z-index: 1000;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('avatarModal');
    const modalAvatar = document.getElementById('modalAvatar');
    const closeButton = document.querySelector('.close-button');
    const confirmButton = document.getElementById('confirmAvatar');
    const cancelButton = document.getElementById('cancelAvatar');
    let selectedAvatar = '';

    // Add click event to all avatar items
    document.querySelectorAll('.avatar-item').forEach(item => {
        item.addEventListener('click', function() {
            const avatarSrc = this.querySelector('img').src;
            selectedAvatar = this.getAttribute('data-avatar');
            modalAvatar.src = avatarSrc;
            modal.style.display = 'block';
        });
    });

    // Close modal when clicking the close button
    closeButton.addEventListener('click', function() {
        modal.style.display = 'none';
    });

    // Close modal when clicking outside the modal content
    window.addEventListener('click', function(event) {
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Handle confirm button click
    confirmButton.addEventListener('click', function() {
        fetch('/update_avatar', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                avatar_name: selectedAvatar
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.textContent = 'Avatar updated successfully!';
                document.body.appendChild(successMessage);
                
                // Remove success message after 2 seconds
                setTimeout(() => {
                    successMessage.remove();
                }, 2000);

                // Close modal
                modal.style.display = 'none';
                
                // Refresh the page to update the header avatar
                window.location.reload();
            } else if (data.error) {
                alert(data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred while updating the avatar');
        });
    });

    // Handle cancel button click
    cancelButton.addEventListener('click', function() {
        modal.style.display = 'none';
    });
});
</script>
{% endblock %} 